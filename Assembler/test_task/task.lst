GAS LISTING task.s 			page 1


   1              	.globl _start
   2              	.data
   3              	.set 	N, 100
   4              	.set	WRITE, 1
   5              	.set	EXIT, 60
   6 0000 0000     	operands_count:		.word 0
   7 0002 00       	operation_symbol:	.skip 1
   8 0003 00000000 	tmp_number:		.skip N
   8      00000000 
   8      00000000 
   8      00000000 
   8      00000000 
   9 0067 00       	current_numeral:	.skip 1
  10 0068 00000000 	big_empty: 		.skip N
  10      00000000 
  10      00000000 
  10      00000000 
  10      00000000 
  11 00cc 00       	small_empty: 		.skip 1
  12 00cd 00000000 	current_number:		.quad 0
  12      00000000 
  13 00d5 30313233 	numeral_char_tab:	.ascii "0123456789"
  13      34353637 
  13      3839
  14              	numerals_count = 	. - numeral_char_tab
  15 00df 2B2D2A2F 	operation_char_tab:	.ascii "+-*/#"
  15      23
  16              	operations_count = 	. - operation_char_tab
  17 00e4 2B       	op_add:	.ascii "+"
  18 00e5 2D       	op_sub:	.ascii "-"
  19 00e6 2A       	op_mov:	.ascii "*"
  20 00e7 2F       	op_div:	.ascii "/"
  21 00e8 23       	op_unary_minus: .ascii "#"
  22 00e9 0A       	line_break:	.ascii "\n"
  23 00ea 536F6D65 	err_messg:	.ascii "Something wrong\n"
  23      7468696E 
  23      67207772 
  23      6F6E670A 
  24              	lerr_messg = . - err_messg
  25              	
  26              	.text
  27              	_start:
  28 0000 4D31D2   		xorq 	%r10, %r10		# r10 –∏–≥—Ä–∞–µ—Ç —Ä–æ–ª—å —Å—á—ë—Ç—á–∏–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞–Ω–¥
  29 0003 4C8B1C24 		mov 	(%rsp), %r11
  30 0007 49FFCB   		dec 	%r11 			# r11 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–∞–º –ø–µ—Ä–µ–¥–∞–ª–
  31 000a 4983FB00 		cmp 	$0, %r11
  32 000e 0F845E02 		jz 	_error
  32      0000
  33              	
  34 0014 4C8D2425 		lea 	tmp_number, %r12 	# r12 - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏ tmp_number
  34      00000000 
  35 001c 49C7C502 		mov	$2, %r13
  35      000000
  36 0023 4E8B34EC 		mov	(%rsp, %r13, 8), %r14	# r14 - —Ç–µ–∫—É—â–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç
  37 0027 EB10     		jmp 	_parse_argument
  38              	
  39              	_result:
GAS LISTING task.s 			page 2


  40 0029 4983FA01 		cmp 	$1, %r10
  41 002d 0F8F3F02 		jg 	_error
  41      0000
  42 0033 58       		popq 	%rax
  43 0034 E96A0200 		jmp 	_numprint
  43      00
  44              	# ---------------------------------------------------
  45              	_parse_argument:
  46 0039 4831DB   		xor 	%rbx, %rbx
  47 003c 418A1E   		mov 	(%r14), %bl
  48 003f 80FB00   		cmp 	$0, %bl
  49 0042 7417     		jz 	_end_argument
  50              	
  51 0044 E82C0000 		call 	_grasp_operation_symbol
  51      00
  52 0049 E9410100 		jmp 	_execute_operation
  52      00
  53              	_continue_grasp:
  54 004e E85F0000 		call 	_grasp_numeral
  54      00
  55              	_continue_parse_argument:
  56 0053 4D31C0   		xor 	%r8, %r8
  57 0056 49FFC6   		inc 	%r14
  58 0059 EBDE     		jmp 	_parse_argument
  59              	_end_argument:
  60 005b E8910000 		call 	_push_num_to_stack
  60      00
  61 0060 49FFCB   		dec 	%r11
  62 0063 74C4     		jz 	_result
  63 0065 4983C501 		add 	$1, %r13
  64 0069 4C89EA   		mov 	%r13, %rdx
  65 006c 4C01D2   		add 	%r10, %rdx
  66 006f 4C8B34D4 		mov	(%rsp, %rdx, 8), %r14
  67 0073 EBC4     		jmp 	_parse_argument
  68              	# ---------------------------------------------------
  69              	 _grasp_operation_symbol:
  70 0075 49C7C705 	 	mov 	$operations_count, %r15
  70      000000
  71 007c 48C7C101 		mov 	$1, %rcx
  71      000000
  72 0083 4C89F6   		mov	%r14, %rsi
  73 0086 488D3C25 		lea	operation_char_tab, %rdi
  73      00000000 
  74              	 _grasp_operation_loop:
  75 008e A6       		cmpsb
  76 008f 7409     		je	_end_grasp_operation
  77 0091 48FFCE   		dec	%rsi
  78 0094 49FFCF   		dec 	%r15
  79 0097 75F5     		jnz 	_grasp_operation_loop
  80 0099 C3       		ret
  81              	_end_grasp_operation:
  82 009a 48FFCF   		dec 	%rdi
  83 009d 4889FE   		mov 	%rdi, %rsi
  84 00a0 488D3C25 		lea 	operation_symbol, %rdi
  84      00000000 
  85 00a8 48C7C101 		mov 	$1, %rcx
  85      000000
GAS LISTING task.s 			page 3


  86 00af F3A4     		rep movsb
  87 00b1 C3       		ret
  88              	# ---------------------------------------------------
  89              	_grasp_numeral:
  90 00b2 49C7C70A 		mov 	$numerals_count, %r15
  90      000000
  91 00b9 48C7C101 		mov 	$1, %rcx
  91      000000
  92 00c0 4C89F6   		mov 	%r14, %rsi
  93 00c3 488D3C25 		lea 	numeral_char_tab, %rdi
  93      00000000 
  94              	_grasp_numeral_loop:
  95 00cb A6       		cmpsb
  96 00cc 740D     		je	_end_grasp_numeral
  97 00ce 48FFCE   		dec	%rsi
  98 00d1 49FFCF   		dec 	%r15
  99 00d4 75F5     		jnz 	_grasp_numeral_loop
 100 00d6 E9970100 		jmp 	_error
 100      00
 101              	_end_grasp_numeral:
 102 00db 48FFCF   		dec 	%rdi
 103 00de 4889FE   		mov 	%rdi, %rsi
 104 00e1 4C89E7   		mov 	%r12, %rdi
 105 00e4 48C7C101 		mov 	$1, %rcx
 105      000000
 106 00eb F3A4     		rep movsb
 107 00ed 49FFC4   		inc 	%r12
 108 00f0 C3       		ret
 109              	# ---------------------------------------------------
 110              	_push_num_to_stack:
 111 00f1 488D3425 		lea 	tmp_number, %rsi
 111      00000000 
 112 00f9 833E00   		cmp 	$0, (%rsi)
 113 00fc 7410     		jz 	_end_push
 114 00fe E85A0000 		call 	_parse_to_int
 114      00
 115 0103 5A       		pop 	%rdx
 116 0104 50       		pushq 	%rax
 117 0105 52       		push 	%rdx
 118 0106 49FFC2   		inc 	%r10
 119 0109 E8010000 		call	_clear_tmp_number
 119      00
 120              	_end_push:
 121 010e C3       		ret
 122              	# ---------------------------------------------------
 123              	_clear_tmp_number:
 124 010f 488D3425 		lea	big_empty, %rsi
 124      00000000 
 125 0117 488D3C25 		lea 	tmp_number, %rdi
 125      00000000 
 126 011f 48C7C164 		mov 	$N, %rcx
 126      000000
 127 0126 EB32     		jmp 	_clear_string
 128              	_clear_operation_symbol:
 129 0128 488D3425 		lea	small_empty, %rsi
 129      00000000 
 130 0130 488D3C25 		lea 	operation_symbol, %rdi
GAS LISTING task.s 			page 4


 130      00000000 
 131 0138 48C7C101 		mov 	$1, %rcx
 131      000000
 132 013f EB19     		jmp 	_clear_string
 133              	_clear_current_numeral:
 134 0141 488D3425 		lea	small_empty, %rsi
 134      00000000 
 135 0149 488D3C25 		lea 	current_numeral, %rdi
 135      00000000 
 136 0151 48C7C101 		mov 	$1, %rcx
 136      000000
 137 0158 EB00     		jmp 	_clear_string
 138              	_clear_string:
 139 015a F3A4     		rep movsb
 140 015c C3       		ret
 141              	# ---------------------------------------------------
 142              	_parse_to_int:
 143 015d 488D3425 		lea 	tmp_number, %rsi
 143      00000000 
 144 0165 EB00     		jmp	_ii1
 145              	_ii1:
 146 0167 4831C0   		xor 	%rax, %rax
 147 016a 48C7C30A 		mov 	$10, %rbx
 147      000000
 148              	_ii2:
 149 0171 8A0E     		mov 	(%rsi), %cl
 150 0173 80F900   		cmp 	$0, %cl
 151 0176 740E     		jz 	_end_number
 152              	
 153 0178 80E930   		sub 	$'0', %cl
 154 017b 48F7E3   		mul 	%rbx
 155 017e 4801C8   		add 	%rcx, %rax
 156 0181 48FFC6   		inc 	%rsi
 157 0184 EBEB     		jmp 	_ii2
 158              	_end_number:
 159 0186 4C8D2425 		lea 	tmp_number, %r12
 159      00000000 
 160 018e C3       		ret
 161              	# ---------------------------------------------------
 162              	_execute_operation:
 163 018f 48C7C600 		mov 	$operation_symbol, %rsi
 163      000000
 164 0196 8A0E     		mov 	(%rsi), %cl
 165 0198 FEC1     		inc 	%cl
 166 019a 80F901   		cmp 	$1, %cl
 167 019d 0F84ABFE 		je 	_continue_grasp
 167      FFFF
 168              	
 169 01a3 E849FFFF 		call 	_push_num_to_stack
 169      FF
 170              	
 171 01a8 48C7C600 		mov 	$operation_symbol, %rsi
 171      000000
 172 01af 48C7C101 		mov 	$1, %rcx
 172      000000
 173 01b6 488D3C25 		lea	op_add, %rdi
 173      00000000 
GAS LISTING task.s 			page 5


 174 01be A6       		cmpsb
 175 01bf 7442     		je	add_op
 176              	
 177 01c1 48FFCE   		dec	%rsi
 178 01c4 668D3C25 		lea	op_sub, %di
 178      00000000 
 179 01cc A6       		cmpsb
 180 01cd 7445     		je	sub_op
 181              	
 182 01cf 48FFCE   		dec	%rsi
 183 01d2 668D3C25 		lea	op_mov, %di
 183      00000000 
 184 01da A6       		cmpsb
 185 01db 7448     		je	mul_op
 186              	
 187 01dd 48FFCE   		dec	%rsi
 188 01e0 668D3C25 		lea	op_div, %di
 188      00000000 
 189 01e8 A6       		cmpsb
 190 01e9 744B     		je	div_op
 191              	
 192 01eb 48FFCE   		dec	%rsi
 193 01ee 668D3C25 		lea	op_unary_minus, %di
 193      00000000 
 194 01f6 A6       		cmpsb
 195 01f7 746C     		je	unary_minus
 196              	_end_execute_operation:
 197 01f9 E82AFFFF 		call 	_clear_operation_symbol
 197      FF
 198 01fe E950FEFF 		jmp 	_continue_parse_argument
 198      FF
 199              	# ---------------------------------------------------
 200              	add_op:
 201 0203 4983FA02 		cmp	$2, %r10
 202 0207 7C69     		jl 	_error
 203 0209 5B       		popq	%rbx
 204 020a 58       		popq 	%rax
 205 020b 4801D8   		add 	%rbx, %rax
 206 020e 50       		pushq	%rax
 207 020f 49FFCA   		dec 	%r10
 208 0212 EBE5     		jmp 	_end_execute_operation
 209              	sub_op:
 210 0214 4983FA02 		cmp	$2, %r10
 211 0218 7C58     		jl 	_error
 212 021a 5B       		popq	%rbx
 213 021b 58       		popq 	%rax
 214 021c 4829D8   		sub 	%rbx, %rax
 215 021f 50       		pushq	%rax
 216 0220 49FFCA   		dec 	%r10
 217 0223 EBD4     		jmp 	_end_execute_operation
 218              	mul_op:
 219 0225 4983FA02 		cmp	$2, %r10
 220 0229 7C47     		jl 	_error
 221 022b 5B       		popq	%rbx
 222 022c 58       		popq 	%rax
 223 022d 48F7E3   		mul 	%rbx
 224 0230 50       		pushq	%rax
GAS LISTING task.s 			page 6


 225 0231 49FFCA   		dec 	%r10
 226 0234 EBC3     		jmp 	_end_execute_operation
 227              	div_op:
 228 0236 4983FA02 		cmp	$2, %r10
 229 023a 7C36     		jl 	_error
 230 023c 4831C9   		xor 	%rcx, %rcx
 231 023f 5B       		popq	%rbx
 232 0240 58       		popq 	%rax
 233 0241 4883F800 		cmp 	$0, %rax
 234 0245 7D0A     		jge 	_do_div
 235 0247 48C7C101 		mov 	$1, %rcx
 235      000000
 236 024e 48F7D8   		neg 	%rax
 237              	_do_div:
 238 0251 4831D2   		xor 	%rdx, %rdx
 239 0254 48F7FB   		idiv 	%rbx
 240 0257 4885C9   		test 	%rcx, %rcx
 241 025a 7403     		jz 	_complete_div
 242 025c 48F7D8   		neg 	%rax
 243              	_complete_div:
 244 025f 50       		pushq 	%rax
 245 0260 49FFCA   		dec 	%r10
 246 0263 EB94     		jmp 	_end_execute_operation
 247              	unary_minus:
 248 0265 4983FA01 		cmp	$1, %r10
 249 0269 7C07     		jl 	_error
 250 026b 58       		popq 	%rax
 251 026c 48F7D8   		neg 	%rax
 252 026f 50       		pushq 	%rax
 253 0270 EB87     		jmp 	_end_execute_operation
 254              	# ---------------------------------------------------
 255              	_error:
 256 0272 48C7C001 		mov	$WRITE, %rax
 256      000000
 257 0279 48C7C701 		mov	$1, %rdi
 257      000000
 258 0280 488D3425 		lea	err_messg, %rsi
 258      00000000 
 259 0288 48C7C210 		mov	$lerr_messg, %rdx
 259      000000
 260 028f 0F05     		syscall
 261 0291 EB00     		jmp	_exit
 262              	# ---------------------------------------------------
 263              	_exit:
 264 0293 48C7C03C 		mov	$EXIT, %rax
 264      000000
 265 029a 48C7C700 		mov	$0, %rdi
 265      000000
 266 02a1 0F05     		syscall
 267              	# ---------------------------------------------------
 268              	_numprint:
 269 02a3 4883F800 		cmp 	$0, %rax
 270 02a7 7D23     		jge 	_0b
 271 02a9 50       		pushq 	%rax
 272 02aa 48C7C001 		mov 	$WRITE, %rax
 272      000000
 273 02b1 48C7C701 		mov 	$1, %rdi
GAS LISTING task.s 			page 7


 273      000000
 274 02b8 48C7C600 		mov 	$op_sub, %rsi
 274      000000
 275 02bf 48C7C201 		mov 	$1, %rdx
 275      000000
 276 02c6 0F05     		syscall
 277 02c8 58       		popq 	%rax
 278 02c9 48F7D8   		neg 	%rax
 279              	_0b:
 280 02cc 4831C9   		xor	%rcx, %rcx
 281 02cf 48C7C30A 		movq	$10, %rbx
 281      000000
 282              	_1b:
 283 02d6 4831D2   		xorq	%rdx, %rdx
 284 02d9 48F7F3   		div	%rbx
 285 02dc 52       		pushq	%rdx
 286 02dd 48FFC1   		inc	%rcx
 287 02e0 4885C0   		testq	%rax, %rax
 288 02e3 75F1     		jnz	_1b
 289              	_2b:
 290 02e5 58       		popq	%rax
 291 02e6 488D3425 		lea	numeral_char_tab, %rsi
 291      00000000 
 292 02ee 4801C6   		add 	%rax, %rsi
 293 02f1 51       		push 	%rcx
 294 02f2 48C7C001 		mov 	$WRITE, %rax
 294      000000
 295 02f9 48C7C701 		mov 	$1, %rdi
 295      000000
 296 0300 48C7C201 		mov 	$1, %rdx
 296      000000
 297 0307 0F05     		syscall
 298 0309 59       		pop 	%rcx
 299 030a 48FFC9   		dec	%rcx
 300 030d 75D6     		jnz	_2b
 301 030f 488D3425 		lea 	line_break, %rsi
 301      00000000 
 302 0317 48C7C001 		mov 	$WRITE, %rax
 302      000000
 303 031e 48C7C701 		mov 	$1, %rdi
 303      000000
 304 0325 48C7C201 		mov 	$1, %rdx
 304      000000
 305 032c 0F05     		syscall
 306 032e E960FFFF 		jmp	_exit...
 306      FF
GAS LISTING task.s 			page 8


DEFINED SYMBOLS
              task.s:27     .text:0000000000000000 _start
              task.s:3      *ABS*:0000000000000064 N
              task.s:4      *ABS*:0000000000000001 WRITE
              task.s:5      *ABS*:000000000000003c EXIT
              task.s:6      .data:0000000000000000 operands_count
              task.s:7      .data:0000000000000002 operation_symbol
              task.s:8      .data:0000000000000003 tmp_number
              task.s:9      .data:0000000000000067 current_numeral
              task.s:10     .data:0000000000000068 big_empty
              task.s:11     .data:00000000000000cc small_empty
              task.s:12     .data:00000000000000cd current_number
              task.s:13     .data:00000000000000d5 numeral_char_tab
              task.s:14     *ABS*:000000000000000a numerals_count
              task.s:15     .data:00000000000000df operation_char_tab
              task.s:16     *ABS*:0000000000000005 operations_count
              task.s:17     .data:00000000000000e4 op_add
              task.s:18     .data:00000000000000e5 op_sub
              task.s:19     .data:00000000000000e6 op_mov
              task.s:20     .data:00000000000000e7 op_div
              task.s:21     .data:00000000000000e8 op_unary_minus
              task.s:22     .data:00000000000000e9 line_break
              task.s:23     .data:00000000000000ea err_messg
              task.s:24     *ABS*:0000000000000010 lerr_messg
              task.s:255    .text:0000000000000272 _error
              task.s:45     .text:0000000000000039 _parse_argument
              task.s:39     .text:0000000000000029 _result
              task.s:268    .text:00000000000002a3 _numprint
              task.s:59     .text:000000000000005b _end_argument
              task.s:69     .text:0000000000000075 _grasp_operation_symbol
              task.s:162    .text:000000000000018f _execute_operation
              task.s:53     .text:000000000000004e _continue_grasp
              task.s:89     .text:00000000000000b2 _grasp_numeral
              task.s:55     .text:0000000000000053 _continue_parse_argument
              task.s:110    .text:00000000000000f1 _push_num_to_stack
              task.s:74     .text:000000000000008e _grasp_operation_loop
              task.s:81     .text:000000000000009a _end_grasp_operation
              task.s:94     .text:00000000000000cb _grasp_numeral_loop
              task.s:101    .text:00000000000000db _end_grasp_numeral
              task.s:120    .text:000000000000010e _end_push
              task.s:142    .text:000000000000015d _parse_to_int
              task.s:123    .text:000000000000010f _clear_tmp_number
              task.s:138    .text:000000000000015a _clear_string
              task.s:128    .text:0000000000000128 _clear_operation_symbol
              task.s:133    .text:0000000000000141 _clear_current_numeral
              task.s:145    .text:0000000000000167 _ii1
              task.s:148    .text:0000000000000171 _ii2
              task.s:158    .text:0000000000000186 _end_number
              task.s:200    .text:0000000000000203 add_op
              task.s:209    .text:0000000000000214 sub_op
              task.s:218    .text:0000000000000225 mul_op
              task.s:227    .text:0000000000000236 div_op
              task.s:247    .text:0000000000000265 unary_minus
              task.s:196    .text:00000000000001f9 _end_execute_operation
              task.s:237    .text:0000000000000251 _do_div
              task.s:243    .text:000000000000025f _complete_div
              task.s:263    .text:0000000000000293 _exit
GAS LISTING task.s 			page 9


              task.s:279    .text:00000000000002cc _0b
              task.s:282    .text:00000000000002d6 _1b
              task.s:289    .text:00000000000002e5 _2b

NO UNDEFINED SYMBOLS
